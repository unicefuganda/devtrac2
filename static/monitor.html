<html>
    <head>
        <script type="text/javascript" src="http://codeorigin.jquery.com/jquery-2.0.3.min.js"></script>

        <script type="text/javascript">

            

            function showNotification(message) {
                var notification = window.webkitNotifications.createNotification(
                  "http://www.google.com/images/logo.png", // icon url - can be relative
                  "Travis CI", 
                  message 
                );

                notification.show();
            } 

            function startPoll(url, pollCallBack) {

                (function poll() {
                    $.ajax({
                        url: url,
                        success: pollCallBack,
                        dataType: "json",
                        complete: function () {
                            setTimeout(poll, 60000);
                        }
                    });
                })();
            }

            $(function() {
                $(".turn-on-monitoring").click(function () {
                    if (window.webkitNotifications.checkPermission() != 0) {
                        window.webkitNotifications.requestPermission();
                    }

                    $(this).text("Monitoring is ON");
                    showNotification("Monitoring is ON");
                    var travisProject = "unicefuganda/devtrac2"
                    var lastBuildNumber = 0

                    startPoll("https://api.travis-ci.org/repos/" + travisProject, function(data) { 
                        if (lastBuildNumber != data.last_build_number)
                        {
                            lastBuildNumber = data.last_build_number;
                            var status = data.last_build_status == 0 ? "Success" : "Failed";
                            showNotification("Build " + status + " in " + data.last_build_duration + " seconds");
                        }
                    });
                    return false
                });


            })

        </script>

    </head>

    <body>
        <a href='#' class='turn-on-monitoring' >turn on monitoring </a>
    </body>

    

</html>